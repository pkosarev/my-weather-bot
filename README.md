# üö¥‚Äç‚ôÇÔ∏è –í–µ–ª–æ-–ø–æ–≥–æ–¥–Ω—ã–π –ë–æ—Ç (my-weather-bot)

–≠—Ç–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ Go, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Ä–µ—à–∏—Ç—å, —Å—Ç–æ–∏—Ç –ª–∏ –∏–¥—Ç–∏ –∫–∞—Ç–∞—Ç—å—Å—è –Ω–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–µ. –û–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–≥–æ–¥—É (—Ç–µ–∫—É—â—É—é –∏ –ø—Ä–æ–≥–Ω–æ–∑) –∏ —Ö—Ä–∞–Ω–∏—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω** —Å –ø–æ–º–æ—â—å—é Docker –∏ Docker Compose, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ –∏ –µ–≥–æ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.

## üöÄ –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

* **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≥–æ–¥—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:** –ö–æ–º–∞–Ω–¥–∞ `/checkride` –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é, —Å–æ–æ–±—â–∞–µ—Ç –æ –ø–æ–≥–æ–¥–µ *–Ω–∞ —Å–µ–π—á–∞—Å* –∏ **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç** —ç—Ç—É –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
* **–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 4 –¥–Ω—è:** –ö–æ–º–∞–Ω–¥–∞ `/forecast` –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–¥–∞–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 4 –¥–Ω—è (–ø—Ä–æ–ø—É—Å–∫–∞—è —Å–µ–≥–æ–¥–Ω—è), –∏—Å–ø–æ–ª—å–∑—É—è **—Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é** –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é.
* **–£–º–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:** –ï—Å–ª–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞, `/forecast` –ø–æ–ø—Ä–æ—Å–∏—Ç –µ–µ –æ–¥–∏–Ω —Ä–∞–∑. –õ—é–±–∞—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è (–¥–∞–∂–µ –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã) –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏ –≤—ã–¥–∞–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑.
* **–°–±—Ä–æ—Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:** –ö–æ–º–∞–Ω–¥—ã `/start` –∏ `/forgetlocation` —É–¥–∞–ª—è—é—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* **–Ø–∑—ã–∫:** [Go](https://go.dev/) (Golang)
* **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** [Docker](https://www.docker.com/) & [Docker Compose](https://docs.docker.com/compose/)
* **API –ü–æ–≥–æ–¥—ã:** [OpenWeatherMap](https://openweathermap.org/)
* **Telegram API:** [go-telegram-bot-api/v5](https://github.com/go-telegram-bot-api/telegram-bot-api)
* **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** [PostgreSQL](https://www.postgresql.org/) (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
* **–î—Ä–∞–π–≤–µ—Ä –ë–î:** [pgx/v5](https://github.com/jackc/pgx)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ö–æ–¥ —Ä–∞–∑–±–∏—Ç –Ω–∞ –ø–∞–∫–µ—Ç—ã –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:

* `/main.go`: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –ª–æ–≥–∏–∫–∞ Telegram-–±–æ—Ç–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "—Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏" (`userState`).
* `/weather/weather.go`: –í—Å—è –ª–æ–≥–∏–∫–∞, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å API OpenWeatherMap (–∑–∞–ø—Ä–æ—Å—ã, –ø–∞—Ä—Å–∏–Ω–≥ JSON, –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–≥–Ω–æ–∑–∞).
* `/storage/storage.go`: –í—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, DML-–æ–ø–µ—Ä–∞—Ü–∏–∏).
* `Dockerfile`: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ Go-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π Docker-–æ–±—Ä–∞–∑ (multi-stage build).
* `docker-compose.yml`: "–î–∏—Ä–∏–∂–µ—Ä" –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ `bot` –∏ `db`.
* `.env.example`: –§–∞–π–ª-—à–∞–±–ª–æ–Ω –¥–ª—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π.

---

## ‚öôÔ∏è –ó–∞–ø—É—Å–∫ (–õ–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Docker)

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤–∞–º **–Ω–µ –Ω—É–∂–µ–Ω** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Go –∏–ª–∏ PostgreSQL –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ. –í–∞–º –Ω—É–∂–µ–Ω **—Ç–æ–ª—å–∫–æ Docker Desktop**.

### 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

* –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π [Docker Desktop](https://www.docker.com/products/docker-desktop/) (–æ–Ω –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è Docker –∏ `docker compose`).

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone [https://github.com/pkosarev/my-weather-bot.git](https://github.com/pkosarev/my-weather-bot.git)
cd my-weather-bot
```

### 3. –§–∞–π–ª `.env` (–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç docker-compose.yml, –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ .env —Ñ–∞–π–ª–∞ (–∫–æ—Ç–æ—Ä—ã–π –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ Git).

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª-—à–∞–±–ª–æ–Ω .env.example:

```bash
cp .env.example .env
```
2. –û—Ç–∫—Ä–æ–π—Ç–µ .env –ª—é–±—ã–º —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏:

```bash
# –¢–æ–∫–µ–Ω –æ—Ç @BotFather –≤ Telegram
TELEGRAM_TOKEN=123456:ABC...

# –í–∞—à API-–∫–ª—é—á —Å —Å–∞–π—Ç–∞ OpenWeatherMap
WEATHER_API_KEY=abc123...

# –°–µ–∫—Ä–µ—Ç—ã –¥–ª—è –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
POSTGRES_USER=postgres
POSTGRES_PASSWORD=mysecretpassword
POSTGRES_DB=my-weather-bot-db
```

### 4. –°–±–æ—Ä–∫–∞ –∏ –ó–∞–ø—É—Å–∫

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
docker compose up -d
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –°–æ–±–µ—Ä–µ—Ç Go-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Å–æ–≥–ª–∞—Å–Ω–æ `Dockerfile`).

2. –°–∫–∞—á–∞–µ—Ç –æ–±—Ä–∞–∑ `postgres:15-alpine`.

3. –ó–∞–ø—É—Å—Ç–∏—Ç –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ —Å–≤—è–∂–µ—Ç –∏—Ö.

4. –°–æ–∑–¥–∞—Å—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É `./postgres-data` –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–∞—à–µ–π –ë–î.

### 5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞ (–≤–∞–∂–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):

```bash
docker compose logs -f bot
```

–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ (—Å —É–¥–∞–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤):

```bash
docker compose down
```

–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –±–æ—Ç–∞ (–µ—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏–ª–∏ Go-–∫–æ–¥):

```bash
docker compose up -d --build
```
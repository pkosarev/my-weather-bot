# üö¥‚Äç‚ôÇÔ∏è –í–µ–ª–æ-–ø–æ–≥–æ–¥–Ω—ã–π –ë–æ—Ç (my-weather-bot)

–≠—Ç–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ Go, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Ä–µ—à–∏—Ç—å, —Å—Ç–æ–∏—Ç –ª–∏ –∏–¥—Ç–∏ –∫–∞—Ç–∞—Ç—å—Å—è –Ω–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–µ. –û–Ω –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–≥–æ–¥—É, –∞ **–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑ —Å –ø–æ–º–æ—â—å—é LLM (Groq)**, —á—Ç–æ–±—ã –¥–∞—Ç—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π —Å–æ–≤–µ—Ç.

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω** —Å –ø–æ–º–æ—â—å—é Docker –∏ Docker Compose, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ –∏ –µ–≥–æ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.

## üöÄ –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

* ü§ñ **–ê–Ω–∞–ª–∏–∑ –æ—Ç LLM:** –í—Å–µ –æ—Ç–≤–µ—Ç—ã –æ –ø–æ–≥–æ–¥–µ (–Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –Ω–∞ 4 –¥–Ω—è) –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é (Groq), —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å "–∂–∏–≤–æ–π", —á–µ–ª–æ–≤–µ—á–Ω—ã–π —Å–æ–≤–µ—Ç, –∞ –Ω–µ "—Å—É—Ö–∏–µ" —Ü–∏—Ñ—Ä—ã.
* üå§Ô∏è **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≥–æ–¥—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:** –ö–æ–º–∞–Ω–¥–∞ `/checkride` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–≥–æ–¥—É *–Ω–∞ —Å–µ–π—á–∞—Å*.
* üóìÔ∏è **–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 4 –¥–Ω—è:** –ö–æ–º–∞–Ω–¥–∞ `/forecast` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 4 –¥–Ω—è (–ø—Ä–æ–ø—É—Å–∫–∞—è —Å–µ–≥–æ–¥–Ω—è).
* üíæ **–£–º–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:** –û–±–µ –∫–æ–º–∞–Ω–¥—ã (`/checkride` –∏ `/forecast`) —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–∞—à—É **—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é**. –ï—Å–ª–∏ –µ–µ –Ω–µ—Ç, –±–æ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç –ø—Ä–∏—Å–ª–∞—Ç—å –µ–µ –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∑–∞–ø–æ–º–Ω–∏—Ç –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
* üîÑ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ "–Ω–∞ –ª–µ—Ç—É":** –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ *–±–µ–∑* –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç –≤–∞—à—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –≤—ã–¥–∞—Å—Ç –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 4 –¥–Ω—è.
* üóëÔ∏è **–°–±—Ä–æ—Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:** –ö–æ–º–∞–Ω–¥—ã `/start` –∏ `/forgetlocation` —É–¥–∞–ª—è—é—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* **–Ø–∑—ã–∫:** [Go](https://go.dev/) (Golang)
* **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** [Docker](https://www.docker.com/) & [Docker Compose](https://docs.docker.com/compose/)
* ü§ñ **LLM:** [Groq API](https://groq.com/) (–¥–ª—è "–∂–∏–≤—ã—Ö" –æ—Ç–≤–µ—Ç–æ–≤)
* **API –ü–æ–≥–æ–¥—ã:** [OpenWeatherMap](https://openweathermap.org/)
* **Telegram API:** [go-telegram-bot-api/v5](https://github.com/go-telegram-bot-api/telegram-bot-api)
* **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** [PostgreSQL](https://www.postgresql.org/) (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
* **–î—Ä–∞–π–≤–µ—Ä –ë–î:** [pgx/v5](https://github.com/jackc/pgx)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ö–æ–¥ —Ä–∞–∑–±–∏—Ç –Ω–∞ –ø–∞–∫–µ—Ç—ã –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–ü—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏):

* `/main.go`: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞. –û—Ç–≤–µ—á–∞–µ—Ç **—Ç–æ–ª—å–∫–æ** –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é (–∑–∞–≥—Ä—É–∑–∫—É `.env`, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, —Å–æ–∑–¥–∞–Ω–∏–µ API) –∏ –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞.
* `/bot/bot.go`: **–ì–ª–∞–≤–Ω—ã–π "–¥–∏—Ä–∏–∂–µ—Ä"**. –•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `userState`, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è, –≤—ã–∑—ã–≤–∞–µ—Ç `weather` –∏ `llm`.
* `/weather/weather.go`: –û—Ç–≤–µ—á–∞–µ—Ç **—Ç–æ–ª—å–∫–æ** –∑–∞ API OpenWeatherMap. –ü–æ–ª—É—á–∞–µ—Ç "—Å—ã—Ä—ã–µ" –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ –∏ –≥–æ—Ç–æ–≤–∏—Ç "—Å—É—Ö–∏–µ" —Å–≤–æ–¥–∫–∏ –¥–ª—è LLM.
* `/llm/llm.go`: –û—Ç–≤–µ—á–∞–µ—Ç **—Ç–æ–ª—å–∫–æ** –∑–∞ API Groq. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏ —Å–≤–æ–¥–∫—É –ø–æ–≥–æ–¥—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π "–∂–∏–≤–æ–π" –æ—Ç–≤–µ—Ç.
* `/storage/storage.go`: –û—Ç–≤–µ—á–∞–µ—Ç **—Ç–æ–ª—å–∫–æ** –∑–∞ –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, `Get`, `Save`, `Delete`).
* `Dockerfile`: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ Go-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π Docker-–æ–±—Ä–∞–∑ (multi-stage build).
* `docker-compose.yml`: "–î–∏—Ä–∏–∂–µ—Ä" –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ `bot` –∏ `db`.
* `.env.example`: –§–∞–π–ª-—à–∞–±–ª–æ–Ω –¥–ª—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π.

---

## ‚öôÔ∏è –ó–∞–ø—É—Å–∫ (–õ–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Docker)

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤–∞–º **–Ω–µ –Ω—É–∂–µ–Ω** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Go –∏–ª–∏ PostgreSQL –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ. –í–∞–º –Ω—É–∂–µ–Ω **—Ç–æ–ª—å–∫–æ Docker Desktop**.

### 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

* –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π [Docker Desktop](https://www.docker.com/products/docker-desktop/) (–æ–Ω –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è Docker –∏ `docker compose`).

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone [https://github.com/pkosarev/my-weather-bot.git](https://github.com/pkosarev/my-weather-bot.git)
cd my-weather-bot
```

### 3. –§–∞–π–ª `.env` (–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `docker-compose.yml`, –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ `.env` —Ñ–∞–π–ª–∞ (–∫–æ—Ç–æ—Ä—ã–π –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ Git).

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª-—à–∞–±–ª–æ–Ω .env.example:

```bash
cp .env.example .env
```
2. –û—Ç–∫—Ä–æ–π—Ç–µ .env –ª—é–±—ã–º —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏:

```bash
# –¢–æ–∫–µ–Ω –æ—Ç @BotFather –≤ Telegram
TELEGRAM_TOKEN=123456:ABC...

# –í–∞—à API-–∫–ª—é—á —Å —Å–∞–π—Ç–∞ OpenWeatherMap
WEATHER_API_KEY=abc123...

# –í–∞—à API-–∫–ª—é—á —Å —Å–∞–π—Ç–∞ Groq
GROQ_API_KEY=gsk_...

# –°–µ–∫—Ä–µ—Ç—ã –¥–ª—è –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
POSTGRES_USER=postgres
POSTGRES_PASSWORD=mysecretpassword
POSTGRES_DB=my-weather-bot-db
```

### 4. –°–±–æ—Ä–∫–∞ –∏ –ó–∞–ø—É—Å–∫

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
docker compose up -d --build
```
(–§–ª–∞–≥ `--build` –Ω—É–∂–µ–Ω –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏–ª–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.go` –∫–æ–¥–∞).

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –°–æ–±–µ—Ä–µ—Ç Go-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Å–æ–≥–ª–∞—Å–Ω–æ `Dockerfile`).

2. –°–∫–∞—á–∞–µ—Ç –æ–±—Ä–∞–∑ `postgres:15-alpine`.

3. –ó–∞–ø—É—Å—Ç–∏—Ç –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ —Å–≤—è–∂–µ—Ç –∏—Ö.

4. –°–æ–∑–¥–∞—Å—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É `./postgres-data` –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–∞—à–µ–π –ë–î.

### 5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞ (–≤–∞–∂–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):

```bash
docker compose logs -f bot
```

–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ (—Å —É–¥–∞–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤):

```bash
docker compose down
```

–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –±–æ—Ç–∞ (–µ—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏–ª–∏ Go-–∫–æ–¥):

```bash
docker compose up -d --build
```